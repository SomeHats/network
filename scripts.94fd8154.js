parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({21:[function(require,module,exports) {
"use strict";var e=function(e,r,n,i,o,a,t,f){if(!e){var s;if(void 0===r)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[n,i,o,a,t,f],l=0;(s=new Error(r.replace(/%s/g,function(){return d[l++]}))).name="Invariant Violation"}throw s.framesToPop=1,s}};module.exports=e;
},{}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),t=require("invariant"),s=n(t);function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=1,r=1,h=1,c=function(){function t(e,s){var n=this,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;i(this,t),this._children=[],this._isPlaying=!1,this._frameHandle=null,this._lastElapsedTime=null,this._systemsByName={},this._systems=[],this._tick=function(e){e*=a;var t=n._lastElapsedTime;if(null!==t){var s=e-t;n.isPlaying&&(n.update(s),n.draw(e))}n._lastElapsedTime=e,n._frameHandle=window.requestAnimationFrame(n._tick)},this._canvas=document.createElement("canvas"),this._canvas.width=e*h,this._canvas.height=s*h,this._canvas.style.width=e+"px",this._canvas.style.height=s+"px",this._ctx=this._canvas.getContext("2d"),this._scaleFactor=h*r,this._setupVisiblityChange()}return e(t,[{key:"appendTo",value:function(e){e.appendChild(this._canvas)}},{key:"hasSystem",value:function(e){return(0,s.default)(e.systemName,"system must have name"),Object.prototype.hasOwnProperty.call(this._systemsByName,e.systemName)&&!!this._systemsByName[e.systemName]}},{key:"getSystem",value:function(e){var t=e.systemName;(0,s.default)(t,"system must have name");var n=this._systemsByName[t];return(0,s.default)(n,"system "+t+" not found"),(0,s.default)(n instanceof e,"system "+t+" is wrong instance type"),n}},{key:"addSystem",value:function(e){(0,s.default)(!this.hasSystem(e.constructor),"only one system of each type allowed"),this._systemsByName[e.constructor.systemName]=e,this._systems.push(e),e.afterAddToScene(this)}},{key:"removeSystem",value:function(e){var t=this.getSystem(e);t.beforeRemoveFromScene(this),delete this._systemsByName[e.systemName],this._systems=this._systems.filter(function(e){return e!==t})}},{key:"addChild",value:function(e){this._children.push(e),e.onAddedToScene(this)}},{key:"addChildBefore",value:function(e,t){var n=this._children.indexOf(e);(0,s.default)(-1!==n,"target child must be present"),this.addChildAtIndex(n,t)}},{key:"addChildAfter",value:function(e,t){var n=this._children.indexOf(e);(0,s.default)(-1!==n,"target child must be present"),this.addChildAtIndex(n+1,t)}},{key:"addChildAtIndex",value:function(e,t){this._children.splice(e,0,t),t.onAddedToScene(this)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return-1!==t&&(this.removeChildAtIndex(t),!0)}},{key:"removeChildAtIndex",value:function(e){var t=this._children[e];return this._children.splice(e,1),t.onRemovedFromScene(),t}},{key:"update",value:function(e){for(var t=0;t<h;t++)this._systems.forEach(function(t){return t.beforeUpdate(e)}),this._children.forEach(function(t){return t.update(e)}),this._systems.forEach(function(t){return t.afterUpdate(e)})}},{key:"draw",value:function(e){var t=this;this._ctx.save(),this._ctx.scale(this._scaleFactor,this._scaleFactor),this._ctx.clearRect(0,0,this.width,this.height),this._systems.forEach(function(s){return s.beforeDraw(t._ctx,e)}),this._children.sort(function(e,t){return e.getCurrentZ()-t.getCurrentZ()}).forEach(function(s){return s.draw(t._ctx,e)}),this._systems.forEach(function(s){return s.afterDraw(t._ctx,e)}),this._ctx.restore()}},{key:"start",value:function(){this._isPlaying=!0,this._frameHandle=window.requestAnimationFrame(this._tick)}},{key:"stop",value:function(){null!==this._frameHandle&&(window.cancelAnimationFrame(this._frameHandle),this._frameHandle=null),this._isPlaying=!1,this._lastElapsedTime=null}},{key:"_setupVisiblityChange",value:function(){var e=this,t=!1;document.addEventListener("visibilitychange",function(){document.hidden&&e.isPlaying&&(t=!0,e.stop()),t&&!document.hidden&&(t=!1,e.start())})}},{key:"width",get:function(){return this._canvas.width/this._scaleFactor}},{key:"height",get:function(){return this._canvas.height/this._scaleFactor}},{key:"scaleFactor",get:function(){return this._scaleFactor}},{key:"isPlaying",get:function(){return null!==this._frameHandle&&this._isPlaying},set:function(e){(0,s.default)(null!==this._frameHandle,"cannot set isPlaying without calling start"),this._isPlaying=e}},{key:"children",get:function(){return this._children}}]),t}();exports.default=c;
},{"invariant":21}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var u=n[t];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,u.key,u)}}return function(n,t,u){return t&&e(n.prototype,t),u&&e(n,u),n}}(),n=require("invariant"),t=u(n);function u(e){return e&&e.__esModule?e:{default:e}}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i={},o=function(e){return i[e]||(i[e]=0),e+"@"+i[e]++},a=function(){function n(){r(this,n),this.id=o(this.constructor.name),this._scene=null}return e(n,[{key:"getScene",value:function(){return(0,t.default)(this._scene,"scene must be present"),this._scene}},{key:"draw",value:function(e,n){}},{key:"update",value:function(e){}},{key:"getCurrentZ",value:function(){return 0}},{key:"addTo",value:function(e){return e.addChild(this),this}},{key:"onAddedToScene",value:function(e){this._scene=e}},{key:"onRemovedFromScene",value:function(){this._scene=null}}]),n}();exports.default=a;
},{"invariant":21}],62:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t=require("invariant"),n=s(t),i=require("./Vector2"),r=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(e){return e===1/0||e===-1/0},o=function(){function t(e,n){l(this,t),this.start=e,this.end=n}return e(t,null,[{key:"fromSlopeAndDisplacement",value:function(e,i){return(0,n.default)(!a(e),"cannot create vertical line from displacement"),new t(new r.default(0,i),new r.default(1,e+i))}},{key:"fromSlopeAndPoint",value:function(e,n){if(a(e))return new t(n,new r.default(n.x,n.y+1));var i=n.y-n.x*e;return t.fromSlopeAndDisplacement(e,i)}}]),e(t,[{key:"isPerpendicularTo",value:function(e){return this.isVertical&&e.isVertical||this.slope===e.slope}},{key:"perpendicularLineThroughPoint",value:function(e){return t.fromSlopeAndPoint(this.perpendicularSlope,e)}},{key:"pointAtIntersectionWith",value:function(e){(0,n.default)(!this.isPerpendicularTo(e),"perpendicular lines do not intersect");var t=void 0;t=this.isVertical?this.verticalX:e.isVertical?e.verticalX:(this.displacement-e.displacement)/(e.slope-this.slope);var i=this.isVertical?e.slope*t+e.displacement:this.slope*t+this.displacement;return new r.default(t,i)}},{key:"delta",get:function(){return this.end.subtract(this.start)}},{key:"slope",get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}},{key:"displacement",get:function(){return this.start.y-this.start.x*this.slope}},{key:"isVertical",get:function(){return a(this.slope)}},{key:"verticalX",get:function(){return(0,n.default)(this.isVertical,"verticalX is not defined on non vertical lines"),this.start.x}},{key:"perpendicularSlope",get:function(){return this.isVertical?0:-1/this.slope}}]),t}();exports.default=o;
},{"invariant":21,"./Vector2":35}],29:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=exports.lerp=function(t,n,r){return t+r*(n-t)},n=exports.mapRange=function(n,r,e,o,u){return t(e,o,(u-n)/(r-n))},r=exports.constrain=function(t,n,r){return Math.min(n,Math.max(t,r))},e=exports.random=function(n,r){return t(n,r,Math.random())},o=exports.randomInt=function(t,n){return Math.floor(e(t,n))},u=exports.sample=function(t){return t[o(0,t.length)]},i=exports.flatten=function(t){return t.reduce(function(t,n){return t.concat(n)},[])},a=exports.uniq=function(t){return t.filter(function(n,r){return t.indexOf(n)===r})},c=exports.compact=function(t){return t.filter(function(t){return null!=t})},f=exports.normaliseAngle=function(t){return Math.atan2(Math.sin(t),Math.cos(t))},s=exports.varyAbsolute=function(t,n){return e(t-n,t+n)},p=exports.varyRelative=function(t,n){return s(t,t*n)},x=exports.times=function(t,n){for(var r=[],e=0;e<t;e++)r.push(n(e));return r},l=exports.shuffle=function(t){return t.map(function(t){return[t,Math.random()]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})};
},{}],35:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=require("invariant"),r=a(n),u=require("./Line2"),i=a(u),o=require("../util");function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var y=function(){function n(e,t){s(this,n),this.x=e,this.y=t}return t(n,null,[{key:"from",value:function(t){if(t instanceof n)return new n(t.x,t.y);if(Array.isArray(t))return(0,r.default)("number"==typeof t[0],"vector[0] must be a number"),(0,r.default)("number"==typeof t[1],"vector[1] must be a number"),new n(t[0],t[1]);if(t&&"object"===(void 0===t?"undefined":e(t)))return(0,r.default)("number"==typeof t.x,"vector.x must be a number"),(0,r.default)("number"==typeof t.y,"vector.y must be a number"),new n(t.x,t.y);throw new Error("invalid type to create vector")}},{key:"fromMagnitudeAndAngle",value:function(e,t){return new n(e*Math.cos(t),e*Math.sin(t))}}]),t(n,[{key:"toString",value:function(){return"Vector2("+this.x+", "+this.y+")"}},{key:"debugDraw",value:function(e){var t=window.debugContext;t.beginPath();var n=3*window.HAIRLINE;t.moveTo(this.x-n,this.y-n),t.lineTo(this.x+n,this.y+n),t.moveTo(this.x-n,this.y+n),t.lineTo(this.x+n,this.y-n),t.strokeStyle=e,t.lineWidth=window.HAIRLINE,t.stroke()}},{key:"angleBetween",value:function(e){return e.subtract(this).angle}},{key:"distanceTo",value:function(e){return e.subtract(this).magnitude}},{key:"add",value:function(e){return new n(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new n(this.x-e.x,this.y-e.y)}},{key:"scale",value:function(e){return new n(this.x*e,this.y*e)}},{key:"withMagnitude",value:function(e){return this.scale(e/this.magnitude)}},{key:"normal",value:function(){return new n(-this.y,this.x)}},{key:"invert",value:function(){return this.scale(-1)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"lineThrough",value:function(e){return new i.default(this,e)}},{key:"lerp",value:function(e,t){return new n((0,o.lerp)(this.x,e.x,t),(0,o.lerp)(this.y,e.y,t))}},{key:"magnitudeSquared",get:function(){return this.x*this.x+this.y*this.y}},{key:"magnitude",get:function(){return Math.sqrt(this.magnitudeSquared)}},{key:"angle",get:function(){return Math.atan2(this.y,this.x)}}]),n}();exports.default=y;
},{"invariant":21,"./Line2":62,"../util":29}],33:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),e=require("./Vector2"),i=n(e);function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,n,o,h){r(this,e),this.center=new i.default(t,n),this.width=o,this.height=h}return t(e,null,[{key:"fromLeftTopRightBottom",value:function(t,i,n,r){var o=n-t,h=r-i;return new e(t+o/2,i+h/2,o,h)}}]),t(e,[{key:"toString",value:function(){return"Rect(("+this.left+", "+this.top+"), ("+this.right+", "+this.bottom+"))"}},{key:"debugDraw",value:function(t){var e=window.debugContext;e.strokeStyle=t,e.lineWidth=1,e.strokeRect(this.left,this.top,this.width,this.height)}},{key:"containsPoint",value:function(t){return!(t.x<this.left||t.x>this.right||t.y<this.top||t.y>this.bottom)}},{key:"intersectsRect",value:function(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}},{key:"left",get:function(){return this.center.x-this.width/2}},{key:"top",get:function(){return this.center.y-this.height/2}},{key:"right",get:function(){return this.center.x+this.width/2}},{key:"bottom",get:function(){return this.center.y+this.height/2}}]),e}();exports.default=o;
},{"./Vector2":35}],36:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("./Vector2"),n=u(t),r=require("./Rect"),i=u(r);function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(e,r,i){s(this,t),this.center=new n.default(e,r),this.radius=i}return e(t,[{key:"debugDraw",value:function(e){var t=window.debugContext;t.strokeStyle=e,t.lineWidth=1,t.beginPath(),t.arc(this.center.x,this.center.y,this.radius,0,2*Math.PI,!1),t.stroke()}},{key:"pointOnCircumference",value:function(e){return new n.default(this.center.x+Math.cos(e)*this.radius,this.center.y+Math.sin(e)*this.radius)}},{key:"containsPoint",value:function(e){return e.distanceTo(this.center)<this.radius}},{key:"intersectsCircle",value:function(e){return this.center.distanceTo(e.center)<this.radius+e.radius}},{key:"withRadius",value:function(e){return new t(this.center.x,this.center.y,e)}},{key:"circumference",get:function(){return 2*Math.PI*this.radius}},{key:"boundingBox",get:function(){return new i.default(this.center.x,this.center.y,2*this.radius,2*this.radius)}}]),t}();exports.default=a;
},{"./Vector2":35,"./Rect":33}],44:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("../../util"),n=require("../Vector2"),r=a(n),i=require("../Line2"),u=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(e,t){o(this,n),this.line=new u.default(e,t),Object.freeze(this)}return e(n,[{key:"getPointAtPosition",value:function(e){var n=(0,t.constrain)(0,this.length,e);return this.delta.withMagnitude(n).add(this.start)}},{key:"getAngleAtPosition",value:function(){return this.delta.angle}},{key:"start",get:function(){return this.line.start}},{key:"end",get:function(){return this.line.end}},{key:"delta",get:function(){return this.end.subtract(this.start)}},{key:"length",get:function(){return this.delta.magnitude}},{key:"angle",get:function(){return this.delta.angle}}]),n}();exports.default=l;
},{"../../util":29,"../Vector2":35,"../Line2":62}],42:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t=require("../../util"),n=require("../Vector2"),i=h(n),r=require("../Circle"),a=h(r),c=require("./StraightPathSegment"),s=h(c),l=require("../Line2"),u=h(l);function h(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function(){function n(e,t,i,r){o(this,n),this.circle=new a.default(e.x,e.y,t),this.startAngle=i,this.endAngle=r,Object.freeze(this)}return e(n,null,[{key:"withinCircle",value:function(e,t,i){t+=Math.PI;var r=e.pointOnCircumference(t),a=e.pointOnCircumference(i),c=new u.default(e.center,r).perpendicularLineThroughPoint(r),l=new u.default(e.center,a).perpendicularLineThroughPoint(a);if(c.isPerpendicularTo(l))return new s.default(r,a);var h=c.pointAtIntersectionWith(l);return new n(h,r.distanceTo(h),r.subtract(h).angle,a.subtract(h).angle)}}]),e(n,[{key:"getPointAtPosition",value:function(e){var n=(0,t.mapRange)(0,this.length,this.startAngle,this.startAngle+this.angleDifference,(0,t.constrain)(0,this.length,e));return this.circle.pointOnCircumference(n)}},{key:"getAngleAtPosition",value:function(e){return this.isAnticlockwise?(0,t.mapRange)(0,this.length,this.startAngle,this.startAngle+this.angleDifference,(0,t.constrain)(0,this.length,e))-Math.PI/2:(0,t.mapRange)(0,this.length,this.startAngle,this.startAngle+this.angleDifference,(0,t.constrain)(0,this.length,e))+Math.PI/2}},{key:"start",get:function(){return this.circle.pointOnCircumference(this.startAngle)}},{key:"end",get:function(){return this.circle.pointOnCircumference(this.endAngle)}},{key:"angleDifference",get:function(){return Math.atan2(Math.sin(this.endAngle-this.startAngle),Math.cos(this.endAngle-this.startAngle))}},{key:"length",get:function(){var e=Math.abs(this.angleDifference)/(2*Math.PI);return this.circle.circumference*e}},{key:"isAnticlockwise",get:function(){return this.angleDifference<0}}]),n}();exports.default=f;
},{"../../util":29,"../Vector2":35,"../Circle":36,"./StraightPathSegment":44,"../Line2":62}],30:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./geom/path/StraightPathSegment"),t=c(e),n=require("./geom/path/CirclePathSegment"),r=c(n);function c(e){return e&&e.__esModule?e:{default:e}}exports.default={circle:function(e,t,n,r){e.arc(t,n,r,0,2*Math.PI,!1)},path:function(e,n){n.segments.forEach(function(n,c){if(0===c&&e.moveTo(n.start.x,n.start.y),n instanceof t.default)e.lineTo(n.end.x,n.end.y);else{if(!(n instanceof r.default))throw new Error("Unknown path segment type: "+n.toString());e.arc(n.circle.center.x,n.circle.center.y,n.circle.radius,n.startAngle,n.endAngle,n.isAnticlockwise)}})}};
},{"./geom/path/StraightPathSegment":44,"./geom/path/CirclePathSegment":42}],57:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=exports.reverse=function(t){return function(n){return t(1-n)}},n=exports.linear=function(t){return t},r=exports.inQuad=function(t){return t*t},u=exports.outQuad=function(t){return t*(2-t)},o=exports.inOutQuad=function(t){return t<.5?2*t*t:(4-2*t)*t-1},e=exports.inCubic=function(t){return t*t*t},i=exports.outCubic=function(t){return--t*t*t+1},a=exports.inOutCubic=function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},c=exports.inQuart=function(t){return t*t*t*t},s=exports.outQuart=function(t){return 1- --t*t*t*t},p=exports.inOutQuart=function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},f=exports.inQuint=function(t){return t*t*t*t*t},x=exports.outQuint=function(t){return 1+--t*t*t*t*t},h=exports.inOutQuint=function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t},M=exports.inSine=function(t){return-1*Math.cos(t/1*(.5*Math.PI))+1},v=exports.outSine=function(t){return Math.sin(t/1*(.5*Math.PI))},O=exports.inOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},P=exports.inExpo=function(t){return 0==t?0:Math.pow(2,10*(t-1))},I=exports.outExpo=function(t){return 1==t?1:1-Math.pow(2,-10*t)},l=exports.inOutExpo=function(t){return 0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},Q=exports.inCirc=function(t){return-1*(Math.sqrt(1-t*t)-1)},d=exports.outCirc=function(t){return Math.sqrt(1-(t-=1)*t)},w=exports.inOutCirc=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},B=exports.inElastic=function(t){var n=1.70158,r=0,u=1;return 0==t?0:1==t?1:(r||(r=.3),u<1?(u=1,n=r/4):n=r/(2*Math.PI)*Math.asin(1/u),-u*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r))},C=exports.outElastic=function(t){var n=1.70158,r=0,u=1;return 0==t?0:1==t?1:(r||(r=.3),u<1?(u=1,n=r/4):n=r/(2*Math.PI)*Math.asin(1/u),u*Math.pow(2,-10*t)*Math.sin((t-n)*(2*Math.PI)/r)+1)},E=exports.inOutElastic=function(t){var n=1.70158,r=0,u=1;return 0==t?0:2==(t/=.5)?1:(r||(r=.3*1.5),u<1?(u=1,n=r/4):n=r/(2*Math.PI)*Math.asin(1/u),t<1?u*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r)*-.5:u*Math.pow(2,-10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r)*.5+1)},b=exports.inBack=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.70158;return function(n){return 1*n*n*((t+1)*n-t)}},q=exports.outBack=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.70158;return function(n){return 1*((n-=1)*n*((t+1)*n+t)+1)}},g=exports.inOutBack=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.70158;return function(n){return(n/=.5)<1?n*n*((1+(t*=1.525))*n-t)*.5:.5*((n-=2)*n*((1+(t*=1.525))*n+t)+2)}},k=exports.inBounce=function(t){return 1-S(1-t)},S=exports.outBounce=function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},_=exports.inOutBounce=function(t){return t<.5?.5*k(2*t):.5*S(2*t-1)+.5};
},{}],58:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),t=require("../lib/core/SceneObject"),r=l(t),i=require("../lib/ShapeHelpers"),o=l(i),n=require("../lib/geom/Circle"),s=l(n),a=require("../lib/easings"),u=require("../lib/util");function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _=function(t){function i(e){var t=e.x,r=e.y,o=e.startRadius,n=e.endRadius,u=e.duration,l=e.color,p=e.easeRadius,_=void 0===p?a.linear:p,d=e.easeOpacity,h=void 0===d?a.linear:d,b=e.removeOnComplete,y=void 0!==b&&b;c(this,i);var v=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return v._circle=new s.default(t,r,o),v._startRadius=o,v._endRadius=n,v._duration=u,v._color=l,v._progress=0,v._easeRadius=_,v._easeOpacity=h,v._removeOnComplete=y,v}return p(i,r.default),e(i,[{key:"update",value:function(e){var t=e/this._duration;this._progress=Math.min(1,this._progress+t),this._circle.radius=(0,u.lerp)(this._startRadius,this._endRadius,this._easeRadius(this._progress)),1===this._progress&&this._removeOnComplete&&this.getScene().removeChild(this)}},{key:"draw",value:function(e){e.beginPath();var t=this._easeOpacity(this._progress);e.fillStyle=this._color.fade(t).toString(),o.default.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill()}}]),i}();exports.default=_;
},{"../lib/core/SceneObject":34,"../lib/ShapeHelpers":30,"../lib/geom/Circle":36,"../lib/easings":57,"../lib/util":29}],68:[function(require,module,exports) {
"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};
},{}],70:[function(require,module,exports) {
"use strict";module.exports=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))};
},{}],69:[function(require,module,exports) {
"use strict";var r=require("is-arrayish"),t=Array.prototype.concat,e=Array.prototype.slice,a=module.exports=function(a){for(var n=[],o=0,u=a.length;o<u;o++){var c=a[o];r(c)?n=t.call(n,e.call(c)):n.push(c)}return n};a.wrap=function(r){return function(){return r(a(arguments))}};
},{"is-arrayish":70}],65:[function(require,module,exports) {
var r=require("color-name"),t=require("simple-swizzle"),a={};for(var e in r)r.hasOwnProperty(e)&&(a[r[e]]=e);var n=module.exports={to:{}};function s(r,t,a){return Math.min(Math.max(t,r),a)}function o(r){var t=r.toString(16).toUpperCase();return t.length<2?"0"+t:t}n.get=function(r){var t,a;switch(r.substring(0,3).toLowerCase()){case"hsl":t=n.get.hsl(r),a="hsl";break;case"hwb":t=n.get.hwb(r),a="hwb";break;default:t=n.get.rgb(r),a="rgb"}return t?{model:a,value:t}:null},n.get.rgb=function(t){if(!t)return null;var a,e,n,o=[0,0,0,1];if(a=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=a[2],a=a[1],e=0;e<3;e++){var u=2*e;o[e]=parseInt(a.slice(u,u+2),16)}n&&(o[3]=Math.round(parseInt(n,16)/255*100)/100)}else if(a=t.match(/^#([a-f0-9]{3,4})$/i)){for(n=(a=a[1])[3],e=0;e<3;e++)o[e]=parseInt(a[e]+a[e],16);n&&(o[3]=Math.round(parseInt(n+n,16)/255*100)/100)}else if(a=t.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(e=0;e<3;e++)o[e]=parseInt(a[e+1],0);a[4]&&(o[3]=parseFloat(a[4]))}else{if(!(a=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(a=t.match(/(\D+)/))?"transparent"===a[1]?[0,0,0,0]:(o=r[a[1]])?(o[3]=1,o):null:null;for(e=0;e<3;e++)o[e]=Math.round(2.55*parseFloat(a[e+1]));a[4]&&(o[3]=parseFloat(a[4]))}for(e=0;e<3;e++)o[e]=s(o[e],0,255);return o[3]=s(o[3],0,1),o},n.get.hsl=function(r){if(!r)return null;var t=r.match(/^hsla?\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,s(parseFloat(t[2]),0,100),s(parseFloat(t[3]),0,100),s(isNaN(a)?1:a,0,1)]}return null},n.get.hwb=function(r){if(!r)return null;var t=r.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var a=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,s(parseFloat(t[2]),0,100),s(parseFloat(t[3]),0,100),s(isNaN(a)?1:a,0,1)]}return null},n.to.hex=function(){var r=t(arguments);return"#"+o(r[0])+o(r[1])+o(r[2])+(r[3]<1?o(Math.round(255*r[3])):"")},n.to.rgb=function(){var r=t(arguments);return r.length<4||1===r[3]?"rgb("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+")":"rgba("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+", "+r[3]+")"},n.to.rgb.percent=function(){var r=t(arguments),a=Math.round(r[0]/255*100),e=Math.round(r[1]/255*100),n=Math.round(r[2]/255*100);return r.length<4||1===r[3]?"rgb("+a+"%, "+e+"%, "+n+"%)":"rgba("+a+"%, "+e+"%, "+n+"%, "+r[3]+")"},n.to.hsl=function(){var r=t(arguments);return r.length<4||1===r[3]?"hsl("+r[0]+", "+r[1]+"%, "+r[2]+"%)":"hsla("+r[0]+", "+r[1]+"%, "+r[2]+"%, "+r[3]+")"},n.to.hwb=function(){var r=t(arguments),a="";return r.length>=4&&1!==r[3]&&(a=", "+r[3]),"hwb("+r[0]+", "+r[1]+"%, "+r[2]+"%"+a+")"},n.to.keyword=function(r){return a[r.slice(0,3)]};
},{"color-name":68,"simple-swizzle":69}],66:[function(require,module,exports) {
var r=require("color-name"),n={};for(var a in r)r.hasOwnProperty(a)&&(n[r[a]]=a);var t=module.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var e in t)if(t.hasOwnProperty(e)){if(!("channels"in t[e]))throw new Error("missing channels property: "+e);if(!("labels"in t[e]))throw new Error("missing channel labels property: "+e);if(t[e].labels.length!==t[e].channels)throw new Error("channel and label counts mismatch: "+e);var h=t[e].channels,u=t[e].labels;delete t[e].channels,delete t[e].labels,Object.defineProperty(t[e],"channels",{value:h}),Object.defineProperty(t[e],"labels",{value:u})}function o(r,n){return Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2)}t.rgb.hsl=function(r){var n,a,t=r[0]/255,e=r[1]/255,h=r[2]/255,u=Math.min(t,e,h),o=Math.max(t,e,h),s=o-u;return o===u?n=0:t===o?n=(e-h)/s:e===o?n=2+(h-t)/s:h===o&&(n=4+(t-e)/s),(n=Math.min(60*n,360))<0&&(n+=360),a=(u+o)/2,[n,100*(o===u?0:a<=.5?s/(o+u):s/(2-o-u)),100*a]},t.rgb.hsv=function(r){var n,a,t=r[0],e=r[1],h=r[2],u=Math.min(t,e,h),o=Math.max(t,e,h),s=o-u;return a=0===o?0:s/o*1e3/10,o===u?n=0:t===o?n=(e-h)/s:e===o?n=2+(h-t)/s:h===o&&(n=4+(t-e)/s),(n=Math.min(60*n,360))<0&&(n+=360),[n,a,o/255*1e3/10]},t.rgb.hwb=function(r){var n=r[0],a=r[1],e=r[2];return[t.rgb.hsl(r)[0],100*(1/255*Math.min(n,Math.min(a,e))),100*(e=1-1/255*Math.max(n,Math.max(a,e)))]},t.rgb.cmyk=function(r){var n,a=r[0]/255,t=r[1]/255,e=r[2]/255;return[100*((1-a-(n=Math.min(1-a,1-t,1-e)))/(1-n)||0),100*((1-t-n)/(1-n)||0),100*((1-e-n)/(1-n)||0),100*n]},t.rgb.keyword=function(a){var t=n[a];if(t)return t;var e,h=1/0;for(var u in r)if(r.hasOwnProperty(u)){var s=o(a,r[u]);s<h&&(h=s,e=u)}return e},t.keyword.rgb=function(n){return r[n]},t.rgb.xyz=function(r){var n=r[0]/255,a=r[1]/255,t=r[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.1805*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)),100*(.2126*n+.7152*a+.0722*t),100*(.0193*n+.1192*a+.9505*t)]},t.rgb.lab=function(r){var n=t.rgb.xyz(r),a=n[0],e=n[1],h=n[2];return e/=100,h/=108.883,a=(a/=95.047)>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(a-e),200*(e-(h=h>.008856?Math.pow(h,1/3):7.787*h+16/116))]},t.hsl.rgb=function(r){var n,a,t,e,h,u=r[0]/360,o=r[1]/100,s=r[2]/100;if(0===o)return[h=255*s,h,h];n=2*s-(a=s<.5?s*(1+o):s+o-s*o),e=[0,0,0];for(var c=0;c<3;c++)(t=u+1/3*-(c-1))<0&&t++,t>1&&t--,h=6*t<1?n+6*(a-n)*t:2*t<1?a:3*t<2?n+(a-n)*(2/3-t)*6:n,e[c]=255*h;return e},t.hsl.hsv=function(r){var n=r[0],a=r[1]/100,t=r[2]/100,e=a,h=Math.max(t,.01);return a*=(t*=2)<=1?t:2-t,e*=h<=1?h:2-h,[n,100*(0===t?2*e/(h+e):2*a/(t+a)),100*((t+a)/2)]},t.hsv.rgb=function(r){var n=r[0]/60,a=r[1]/100,t=r[2]/100,e=Math.floor(n)%6,h=n-Math.floor(n),u=255*t*(1-a),o=255*t*(1-a*h),s=255*t*(1-a*(1-h));switch(t*=255,e){case 0:return[t,s,u];case 1:return[o,t,u];case 2:return[u,t,s];case 3:return[u,o,t];case 4:return[s,u,t];case 5:return[t,u,o]}},t.hsv.hsl=function(r){var n,a,t,e=r[0],h=r[1]/100,u=r[2]/100,o=Math.max(u,.01);return t=(2-h)*u,a=h*o,[e,100*(a=(a/=(n=(2-h)*o)<=1?n:2-n)||0),100*(t/=2)]},t.hwb.rgb=function(r){var n,a,t,e,h,u,o,s=r[0]/360,c=r[1]/100,l=r[2]/100,i=c+l;switch(i>1&&(c/=i,l/=i),a=1-l,t=6*s-(n=Math.floor(6*s)),0!=(1&n)&&(t=1-t),e=c+t*(a-c),n){default:case 6:case 0:h=a,u=e,o=c;break;case 1:h=e,u=a,o=c;break;case 2:h=c,u=a,o=e;break;case 3:h=c,u=e,o=a;break;case 4:h=e,u=c,o=a;break;case 5:h=a,u=c,o=e}return[255*h,255*u,255*o]},t.cmyk.rgb=function(r){var n=r[0]/100,a=r[1]/100,t=r[2]/100,e=r[3]/100;return[255*(1-Math.min(1,n*(1-e)+e)),255*(1-Math.min(1,a*(1-e)+e)),255*(1-Math.min(1,t*(1-e)+e))]},t.xyz.rgb=function(r){var n,a,t,e=r[0]/100,h=r[1]/100,u=r[2]/100;return a=-.9689*e+1.8758*h+.0415*u,t=.0557*e+-.204*h+1.057*u,n=(n=3.2406*e+-1.5372*h+-.4986*u)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,[255*(n=Math.min(Math.max(0,n),1)),255*(a=Math.min(Math.max(0,a),1)),255*(t=Math.min(Math.max(0,t),1))]},t.xyz.lab=function(r){var n=r[0],a=r[1],t=r[2];return a/=100,t/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116)-16,500*(n-a),200*(a-(t=t>.008856?Math.pow(t,1/3):7.787*t+16/116))]},t.lab.xyz=function(r){var n,a,t,e=r[0],h=r[1],u=r[2];n=h/500+(a=(e+16)/116),t=a-u/200;var o=Math.pow(a,3),s=Math.pow(n,3),c=Math.pow(t,3);return a=o>.008856?o:(a-16/116)/7.787,n=s>.008856?s:(n-16/116)/7.787,t=c>.008856?c:(t-16/116)/7.787,[n*=95.047,a*=100,t*=108.883]},t.lab.lch=function(r){var n,a=r[0],t=r[1],e=r[2];return(n=360*Math.atan2(e,t)/2/Math.PI)<0&&(n+=360),[a,Math.sqrt(t*t+e*e),n]},t.lch.lab=function(r){var n,a=r[0],t=r[1];return n=r[2]/360*2*Math.PI,[a,t*Math.cos(n),t*Math.sin(n)]},t.rgb.ansi16=function(r){var n=r[0],a=r[1],e=r[2],h=1 in arguments?arguments[1]:t.rgb.hsv(r)[2];if(0===(h=Math.round(h/50)))return 30;var u=30+(Math.round(e/255)<<2|Math.round(a/255)<<1|Math.round(n/255));return 2===h&&(u+=60),u},t.hsv.ansi16=function(r){return t.rgb.ansi16(t.hsv.rgb(r),r[2])},t.rgb.ansi256=function(r){var n=r[0],a=r[1],t=r[2];return n===a&&a===t?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(a/255*5)+Math.round(t/255*5)},t.ansi16.rgb=function(r){var n=r%10;if(0===n||7===n)return r>50&&(n+=3.5),[n=n/10.5*255,n,n];var a=.5*(1+~~(r>50));return[(1&n)*a*255,(n>>1&1)*a*255,(n>>2&1)*a*255]},t.ansi256.rgb=function(r){if(r>=232){var n=10*(r-232)+8;return[n,n,n]}var a;return r-=16,[Math.floor(r/36)/5*255,Math.floor((a=r%36)/6)/5*255,a%6/5*255]},t.rgb.hex=function(r){var n=(((255&Math.round(r[0]))<<16)+((255&Math.round(r[1]))<<8)+(255&Math.round(r[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},t.hex.rgb=function(r){var n=r.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var a=n[0];3===n[0].length&&(a=a.split("").map(function(r){return r+r}).join(""));var t=parseInt(a,16);return[t>>16&255,t>>8&255,255&t]},t.rgb.hcg=function(r){var n,a,t=r[0]/255,e=r[1]/255,h=r[2]/255,u=Math.max(Math.max(t,e),h),o=Math.min(Math.min(t,e),h),s=u-o;return n=s<1?o/(1-s):0,a=s<=0?0:u===t?(e-h)/s%6:u===e?2+(h-t)/s:4+(t-e)/s+4,a/=6,[360*(a%=1),100*s,100*n]},t.hsl.hcg=function(r){var n=r[1]/100,a=r[2]/100,t=1,e=0;return(t=a<.5?2*n*a:2*n*(1-a))<1&&(e=(a-.5*t)/(1-t)),[r[0],100*t,100*e]},t.hsv.hcg=function(r){var n=r[1]/100,a=r[2]/100,t=n*a,e=0;return t<1&&(e=(a-t)/(1-t)),[r[0],100*t,100*e]},t.hcg.rgb=function(r){var n=r[0]/360,a=r[1]/100,t=r[2]/100;if(0===a)return[255*t,255*t,255*t];var e,h=[0,0,0],u=n%1*6,o=u%1,s=1-o;switch(Math.floor(u)){case 0:h[0]=1,h[1]=o,h[2]=0;break;case 1:h[0]=s,h[1]=1,h[2]=0;break;case 2:h[0]=0,h[1]=1,h[2]=o;break;case 3:h[0]=0,h[1]=s,h[2]=1;break;case 4:h[0]=o,h[1]=0,h[2]=1;break;default:h[0]=1,h[1]=0,h[2]=s}return e=(1-a)*t,[255*(a*h[0]+e),255*(a*h[1]+e),255*(a*h[2]+e)]},t.hcg.hsv=function(r){var n=r[1]/100,a=n+r[2]/100*(1-n),t=0;return a>0&&(t=n/a),[r[0],100*t,100*a]},t.hcg.hsl=function(r){var n=r[1]/100,a=r[2]/100*(1-n)+.5*n,t=0;return a>0&&a<.5?t=n/(2*a):a>=.5&&a<1&&(t=n/(2*(1-a))),[r[0],100*t,100*a]},t.hcg.hwb=function(r){var n=r[1]/100,a=n+r[2]/100*(1-n);return[r[0],100*(a-n),100*(1-a)]},t.hwb.hcg=function(r){var n=r[1]/100,a=1-r[2]/100,t=a-n,e=0;return t<1&&(e=(a-t)/(1-t)),[r[0],100*t,100*e]},t.apple.rgb=function(r){return[r[0]/65535*255,r[1]/65535*255,r[2]/65535*255]},t.rgb.apple=function(r){return[r[0]/255*65535,r[1]/255*65535,r[2]/255*65535]},t.gray.rgb=function(r){return[r[0]/100*255,r[0]/100*255,r[0]/100*255]},t.gray.hsl=t.gray.hsv=function(r){return[0,0,r[0]]},t.gray.hwb=function(r){return[0,100,r[0]]},t.gray.cmyk=function(r){return[0,0,0,r[0]]},t.gray.lab=function(r){return[r[0],0,0]},t.gray.hex=function(r){var n=255&Math.round(r[0]/100*255),a=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(a.length)+a},t.rgb.gray=function(r){return[(r[0]+r[1]+r[2])/3/255*100]};
},{"color-name":68}],67:[function(require,module,exports) {
var n=require("./conversions");function r(){for(var r={},e=Object.keys(n),t=e.length,a=0;a<t;a++)r[e[a]]={distance:-1,parent:null};return r}function e(e){var t=r(),a=[e];for(t[e].distance=0;a.length;)for(var o=a.pop(),u=Object.keys(n[o]),c=u.length,i=0;i<c;i++){var s=u[i],f=t[s];-1===f.distance&&(f.distance=t[o].distance+1,f.parent=o,a.unshift(s))}return t}function t(n,r){return function(e){return r(n(e))}}function a(r,e){for(var a=[e[r].parent,r],o=n[e[r].parent][r],u=e[r].parent;e[u].parent;)a.unshift(e[u].parent),o=t(n[e[u].parent][u],o),u=e[u].parent;return o.conversion=a,o}module.exports=function(n){for(var r=e(n),t={},o=Object.keys(r),u=o.length,c=0;c<u;c++){var i=o[c];null!==r[i].parent&&(t[i]=a(i,r))}return t};
},{"./conversions":66}],64:[function(require,module,exports) {
var e=require("./conversions"),n=require("./route"),r={},o=Object.keys(e);function t(e){var n=function(n){return void 0===n||null===n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),e(n))};return"conversion"in e&&(n.conversion=e.conversion),n}function c(e){var n=function(n){if(void 0===n||null===n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var r=e(n);if("object"==typeof r)for(var o=r.length,t=0;t<o;t++)r[t]=Math.round(r[t]);return r};return"conversion"in e&&(n.conversion=e.conversion),n}o.forEach(function(o){r[o]={},Object.defineProperty(r[o],"channels",{value:e[o].channels}),Object.defineProperty(r[o],"labels",{value:e[o].labels});var i=n(o);Object.keys(i).forEach(function(e){var n=i[e];r[o][e]=c(n),r[o][e].raw=t(n)})}),module.exports=r;
},{"./conversions":66,"./route":67}],61:[function(require,module,exports) {
"use strict";var r=require("color-string"),t=require("color-convert"),o=[].slice,n=["keyword","gray","hex"],e={};Object.keys(t).forEach(function(r){e[o.call(t[r].labels).sort().join("")]=r});var i={};function a(h,l){if(!(this instanceof a))return new a(h,l);if(l&&l in n&&(l=null),l&&!(l in t))throw new Error("Unknown model: "+l);var s,c;if(h)if(h instanceof a)this.model=h.model,this.color=h.color.slice(),this.valpha=h.valpha;else if("string"==typeof h){var u=r.get(h);if(null===u)throw new Error("Unable to parse color from string: "+h);this.model=u.model,c=t[this.model].channels,this.color=u.value.slice(0,c),this.valpha="number"==typeof u.value[c]?u.value[c]:1}else if(h.length){this.model=l||"rgb",c=t[this.model].channels;var v=o.call(h,0,c);this.color=f(v,c),this.valpha="number"==typeof h[c]?h[c]:1}else if("number"==typeof h)h&=16777215,this.model="rgb",this.color=[h>>16&255,h>>8&255,255&h],this.valpha=1;else{this.valpha=1;var p=Object.keys(h);"alpha"in h&&(p.splice(p.indexOf("alpha"),1),this.valpha="number"==typeof h.alpha?h.alpha:0);var b=p.sort().join("");if(!(b in e))throw new Error("Unable to parse color from object: "+JSON.stringify(h));this.model=e[b];var m=t[this.model].labels,g=[];for(s=0;s<m.length;s++)g.push(h[m[s]]);this.color=f(g)}else this.model="rgb",this.color=[0,0,0],this.valpha=1;if(i[this.model])for(c=t[this.model].channels,s=0;s<c;s++){var d=i[this.model][s];d&&(this.color[s]=d(this.color[s]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function h(r,t){return Number(r.toFixed(t))}function l(r){return function(t){return h(t,r)}}function s(r,t,o){return(r=Array.isArray(r)?r:[r]).forEach(function(r){(i[r]||(i[r]=[]))[t]=o}),r=r[0],function(n){var e;return arguments.length?(o&&(n=o(n)),(e=this[r]()).color[t]=n,e):(e=this[r]().color[t],o&&(e=o(e)),e)}}function c(r){return function(t){return Math.max(0,Math.min(r,t))}}function u(r){return Array.isArray(r)?r:[r]}function f(r,t){for(var o=0;o<t;o++)"number"!=typeof r[o]&&(r[o]=0);return r}a.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var o=this.model in r.to?this:this.rgb(),n=1===(o=o.round("number"==typeof t?t:1)).valpha?o.color:o.color.concat(this.valpha);return r.to[o.model](n)},percentString:function(t){var o=this.rgb().round("number"==typeof t?t:1),n=1===o.valpha?o.color:o.color.concat(this.valpha);return r.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var r={},o=t[this.model].channels,n=t[this.model].labels,e=0;e<o;e++)r[n[e]]=this.color[e];return 1!==this.valpha&&(r.alpha=this.valpha),r},unitArray:function(){var r=this.rgb().color;return r[0]/=255,r[1]/=255,r[2]/=255,1!==this.valpha&&r.push(this.valpha),r},unitObject:function(){var r=this.rgb().object();return r.r/=255,r.g/=255,r.b/=255,1!==this.valpha&&(r.alpha=this.valpha),r},round:function(r){return r=Math.max(r||0,0),new a(this.color.map(l(r)).concat(this.valpha),this.model)},alpha:function(r){return arguments.length?new a(this.color.concat(Math.max(0,Math.min(1,r))),this.model):this.valpha},red:s("rgb",0,c(255)),green:s("rgb",1,c(255)),blue:s("rgb",2,c(255)),hue:s(["hsl","hsv","hsl","hwb","hcg"],0,function(r){return(r%360+360)%360}),saturationl:s("hsl",1,c(100)),lightness:s("hsl",2,c(100)),saturationv:s("hsv",1,c(100)),value:s("hsv",2,c(100)),chroma:s("hcg",1,c(100)),gray:s("hcg",2,c(100)),white:s("hwb",1,c(100)),wblack:s("hwb",2,c(100)),cyan:s("cmyk",0,c(100)),magenta:s("cmyk",1,c(100)),yellow:s("cmyk",2,c(100)),black:s("cmyk",3,c(100)),x:s("xyz",0,c(100)),y:s("xyz",1,c(100)),z:s("xyz",2,c(100)),l:s("lab",0,c(100)),a:s("lab",1),b:s("lab",2),keyword:function(r){return arguments.length?new a(r):t[this.model].keyword(this.color)},hex:function(t){return arguments.length?new a(t):r.to.hex(this.rgb().round().color)},rgbNumber:function(){var r=this.rgb().color;return(255&r[0])<<16|(255&r[1])<<8|255&r[2]},luminosity:function(){for(var r=this.rgb().color,t=[],o=0;o<r.length;o++){var n=r[o]/255;t[o]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(r){var t=this.luminosity(),o=r.luminosity();return t>o?(t+.05)/(o+.05):(o+.05)/(t+.05)},level:function(r){var t=this.contrast(r);return t>=7.1?"AAA":t>=4.5?"AA":""},isDark:function(){var r=this.rgb().color;return(299*r[0]+587*r[1]+114*r[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var r=this.rgb(),t=0;t<3;t++)r.color[t]=255-r.color[t];return r},lighten:function(r){var t=this.hsl();return t.color[2]+=t.color[2]*r,t},darken:function(r){var t=this.hsl();return t.color[2]-=t.color[2]*r,t},saturate:function(r){var t=this.hsl();return t.color[1]+=t.color[1]*r,t},desaturate:function(r){var t=this.hsl();return t.color[1]-=t.color[1]*r,t},whiten:function(r){var t=this.hwb();return t.color[1]+=t.color[1]*r,t},blacken:function(r){var t=this.hwb();return t.color[2]+=t.color[2]*r,t},grayscale:function(){var r=this.rgb().color,t=.3*r[0]+.59*r[1]+.11*r[2];return a.rgb(t,t,t)},fade:function(r){return this.alpha(this.valpha-this.valpha*r)},opaquer:function(r){return this.alpha(this.valpha+this.valpha*r)},rotate:function(r){var t=this.hsl(),o=t.color[0];return o=(o=(o+r)%360)<0?360+o:o,t.color[0]=o,t},mix:function(r,t){var o=r.rgb(),n=this.rgb(),e=void 0===t?.5:t,i=2*e-1,h=o.alpha()-n.alpha(),l=((i*h==-1?i:(i+h)/(1+i*h))+1)/2,s=1-l;return a.rgb(l*o.red()+s*n.red(),l*o.green()+s*n.green(),l*o.blue()+s*n.blue(),o.alpha()*e+n.alpha()*(1-e))}},Object.keys(t).forEach(function(r){if(-1===n.indexOf(r)){var e=t[r].channels;a.prototype[r]=function(){if(this.model===r)return new a(this);if(arguments.length)return new a(arguments,r);var o="number"==typeof arguments[e]?e:this.valpha;return new a(u(t[this.model][r].raw(this.color)).concat(o),r)},a[r]=function(t){return"number"==typeof t&&(t=f(o.call(arguments),e)),new a(t,r)}}}),module.exports=a;
},{"color-string":65,"color-convert":64}],27:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.YELLOW=exports.RED=exports.BLUE=exports.TEAL=exports.LIGHT_BG=void 0;var e=require("color"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var o=exports.LIGHT_BG=Object.freeze((0,t.default)("#F8FFE5")),s=exports.TEAL=Object.freeze((0,t.default)("#06D6A0")),f=exports.BLUE=Object.freeze((0,t.default)("#1B9AAA")),u=exports.RED=Object.freeze((0,t.default)("#EF476F")),p=exports.YELLOW=Object.freeze((0,t.default)("#FFC43D"));
},{"color":61}],38:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={IN:"IN",OUT:"OUT"};exports.default=e;
},{}],59:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),e=require("../../lib/util"),t=require("./ConnectionDirections"),i=o(t);function o(n){return n&&n.__esModule?n:{default:n}}function u(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(){u(this,t),this.incoming=[],this.outgoing=[]}return n(t,[{key:"add",value:function(n,e){switch(e){case i.default.IN:this.addIncoming(n);break;case i.default.OUT:this.addOutgoing(n);break;default:throw new Error("unknow connection direction "+e)}}},{key:"addIncoming",value:function(n){this.incoming.push(n)}},{key:"addOutgoing",value:function(n){this.outgoing.push(n)}},{key:"sampleIncoming",value:function(){return(0,e.sample)(this.incoming)}},{key:"sampleOutgoing",value:function(){return(0,e.sample)(this.outgoing)}}]),t}();exports.default=r;
},{"../../lib/util":29,"./ConnectionDirections":38}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t=require("invariant"),n=p(t),i=require("../../lib/core/SceneObject"),r=p(i),o=require("../../lib/geom/Circle"),c=p(o),l=require("../../lib/ShapeHelpers"),u=p(l),a=require("../../lib/easings"),s=require("../../lib/util"),f=require("../../effects/Pulse"),h=p(f),_=require("../../colors"),d=require("../lib/ConnectionSet"),y=p(d);function p(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=1e3,w=20,k=30,C=25,S=150,O=500,q=_.RED.lighten(.2).desaturate(.5),x=_.RED.darken(.2),P=_.RED.lighten(.2).fade(.4),R=function(t){function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;v(this,i);var r=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.isDestination=!0,r._timer=0,r._connectionSet=new y.default,r._circle=new c.default(e,t,w),r._visualConnectionCircle=new c.default(e,t,k),r._cooldown=n,r}return b(i,r.default),e(i,[{key:"getVisualConnectionPointAtAngle",value:function(e){return this._visualConnectionCircle.pointOnCircumference(e)}},{key:"getAllReachableNodes",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set).add(this),[this]}},{key:"connectTo",value:function(e,t){this._connectionSet.add(e,t)}},{key:"consumeTraveller",value:function(){(0,n.default)(this.canConsumeTraveller,"must be ready to consumer traveller"),this._resetTimer(),this._pulse()}},{key:"update",value:function(e){this._timer=(0,s.constrain)(0,this._cooldown,this._timer+e)}},{key:"draw",value:function(e){var t=this._timer/this._cooldown,n=(0,s.constrain)(0,1,(0,s.mapRange)(0,S,1,0,this._timer)),i=q.mix(x,n);e.beginPath(),e.fillStyle=i.toString(),u.default.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill(),e.beginPath(),e.fillStyle=x.toString(),e.moveTo(this._circle.center.x,this._circle.center.y),u.default.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius*t),e.fill()}},{key:"_resetTimer",value:function(){this._timer=0}},{key:"_pulse",value:function(){this.getScene().addChildBefore(this,new h.default({x:this._circle.center.x,y:this._circle.center.y,endRadius:w,startRadius:C,duration:O,color:P,easeRadius:(0,a.inBack)(4),easeOpacity:(0,a.reverse)(a.linear),removeOnComplete:!0}))}},{key:"position",get:function(){return this._circle.center}},{key:"canConsumeTraveller",get:function(){return this._timer>=this._cooldown}},{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}}]),i}();exports.default=R;
},{"invariant":21,"../../lib/core/SceneObject":34,"../../lib/geom/Circle":36,"../../lib/ShapeHelpers":30,"../../lib/easings":57,"../../lib/util":29,"../../effects/Pulse":58,"../../colors":27,"../lib/ConnectionSet":59}],31:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("invariant"),n=a(t),r=require("./Scene"),u=a(r);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c="$$AbstractSceneSystem$$",i=function(){function t(){s(this,t),this._scene=null,(0,n.default)(this.constructor!==t,"SceneSystem is an abstract class that must be extended"),(0,n.default)(this.constructor.systemName!==c,"classes extending SceneSystem must override SceneSystem.systemName")}return e(t,[{key:"getScene",value:function(){return(0,n.default)(this._scene,"scene is required"),this._scene}},{key:"afterAddToScene",value:function(e){this._scene=e}},{key:"beforeRemoveFromScene",value:function(e){this._scene=null}},{key:"beforeUpdate",value:function(e){}},{key:"afterUpdate",value:function(e){}},{key:"beforeDraw",value:function(e,t){}},{key:"afterDraw",value:function(e,t){}}]),t}();i.systemName=c,exports.default=i;
},{"invariant":21,"./Scene":13}],32:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),e=require("../geom/Rect"),i=s(e),n=require("../geom/Vector2"),r=s(n);function s(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(t,i){u(this,e),this._items=[],this._nextItemIndex=0,this._subdivisions=null,this.boundary=t,this._getPosition=i}return t(e,[{key:"debugDraw",value:function(t){this.boundary.debugDraw(t),this._subdivisions&&this._subdivisions.forEach(function(e){return e.debugDraw(t)})}},{key:"insert",value:function(t){var i=this._getPosition(t);if(!this.boundary.containsPoint(i))return!1;if(this._nextItemIndex<e.NODE_CAPACITY)return this._items[this._nextItemIndex]=t,this._nextItemIndex++,!0;var n=this._getSubdivisions();if(n[0].insert(t))return!0;if(n[1].insert(t))return!0;if(n[2].insert(t))return!0;if(n[3].insert(t))return!0;throw new Error("Couldnt insert item")}},{key:"remove",value:function(t){var e=this._getPosition(t);if(!this.boundary.containsPoint(e))return!1;var i=this._items.indexOf(t);if(-1!==i)return this._items.splice(i,1),this._nextItemIndex--,!0;var n=this._subdivisions;if(n){if(n[0].remove(t))return!0;if(n[1].remove(t))return!0;if(n[2].remove(t))return!0;if(n[3].remove(t))return!0}return!1}},{key:"clear",value:function(){for(var t=0;t<this._nextItemIndex;t++)this._items[t]=void 0,this._nextItemIndex=0;this._subdivisions&&this._subdivisions.forEach(function(t){return t.clear()})}},{key:"findItemsInRect",value:function(t){var e=[];if(!this.boundary.intersectsRect(t))return e;for(var i=0;i<this._nextItemIndex;i++){var n=this._items[i];if(null!=n){var r=this._getPosition(n);t.containsPoint(r)&&e.push(n)}}var s=this._subdivisions;return s?(s[0].boundary.intersectsRect(t)&&e.push.apply(e,o(s[0].findItemsInRect(t))),s[1].boundary.intersectsRect(t)&&e.push.apply(e,o(s[1].findItemsInRect(t))),s[2].boundary.intersectsRect(t)&&e.push.apply(e,o(s[2].findItemsInRect(t))),s[3].boundary.intersectsRect(t)&&e.push.apply(e,o(s[3].findItemsInRect(t))),e):e}},{key:"findItemsInCircle",value:function(t){var e=this;return this.findItemsInRect(t.boundingBox).filter(function(i){return t.containsPoint(e._getPosition(i))})}},{key:"_getSubdivisions",value:function(){if(this._subdivisions)return this._subdivisions;var t=[new e(i.default.fromLeftTopRightBottom(this.boundary.left,this.boundary.top,this.boundary.center.x,this.boundary.center.y),this._getPosition),new e(i.default.fromLeftTopRightBottom(this.boundary.center.x,this.boundary.top,this.boundary.right,this.boundary.center.y),this._getPosition),new e(i.default.fromLeftTopRightBottom(this.boundary.left,this.boundary.center.y,this.boundary.center.x,this.boundary.bottom),this._getPosition),new e(i.default.fromLeftTopRightBottom(this.boundary.center.x,this.boundary.center.y,this.boundary.right,this.boundary.bottom),this._getPosition)];return this._subdivisions=t,t}}]),e}();a.NODE_CAPACITY=4,exports.default=a;
},{"../geom/Rect":33,"../geom/Vector2":35}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0},r=require("../lib/core/SceneSystem"),n=f(r),o=require("../lib/ds/QuadTree"),i=f(o),u=require("../lib/geom/Rect"),a=f(u),l=require("../entities/Traveller"),c=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=function(r){function o(){return s(this,o),p(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return d(o,n.default),e(o,[{key:"removeTraveller",value:function(e){this._quadTree.remove(e)}},{key:"afterAddToScene",value:function(e){t(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"afterAddToScene",this).call(this,e),this._quadTree=new i.default(a.default.fromLeftTopRightBottom(0,0,e.width,e.height),function(e){return e.position})}},{key:"beforeUpdate",value:function(){var e=this,t=this.getScene();this._quadTree.clear(),t.children.forEach(function(t){t instanceof c.default&&e._quadTree.insert(t)})}},{key:"findTravellersInCircle",value:function(e){return this._quadTree.findItemsInCircle(e)}}]),o}();y.systemName="TravellerFinder",exports.default=y;
},{"../lib/core/SceneSystem":31,"../lib/ds/QuadTree":32,"../lib/geom/Rect":33,"../entities/Traveller":28}],63:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("invariant"),t=o(e);function o(e){return e&&e.__esModule?e:{default:e}}var r={getNextRoad:function(e,o){var n=new Set(e.getAllReachableNodes());n.add(e),(0,t.default)(n.has(o),"destination must be reachable");var a=new Map,u=new Map;for(a.set(e,0);n.size;){var d=r._nodeWithShortestDistance(n,a),i=d.node,s=d.cost;if(n.delete(i),i===o)return r._nextRoadFromRoute(u,e,o);r._updateNeighbours(i,a,s,u)}throw new Error("unreachable i hope")},_nodeWithShortestDistance:function(e,o){var r=1/0,n=null;return e.forEach(function(e){var t=o.get(e);null!=t&&t<=r&&(r=t,n=e)}),(0,t.default)(n,"node must be found"),{node:n,cost:r}},_updateNeighbours:function(e,t,o,r){e.outgoingConnections.forEach(function(e){var n=e.to,a=t.get(n),u=o+e.expectedTimeFromStartToEnd;(null==a||u<=a)&&(t.set(n,u),r.set(n,e))})},_nextRoadFromRoute:function(e,o,r){for(var n=r;e.has(n);){var a=e.get(n);if((0,t.default)(a,"road must exist"),(n=a.from)===o)return a}throw new Error("prev road must be found")}};exports.default=r;
},{"invariant":21}],37:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),n=require("invariant"),t=s(n),o=require("../../lib/geom/Vector2"),i=s(o),r=require("../../lib/util"),u=require("../lib/ConnectionSet"),a=s(u),l=require("../lib/PathFinder"),c=s(l);function s(e){return e&&e.__esModule?e:{default:e}}function f(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var d=function(){function n(e,t){f(this,n),this.isDestination=!1,this._connectionSet=new a.default,this.position=new i.default(e,t)}return e(n,[{key:"consumeTraveller",value:function(e){var n=e.destination;(0,t.default)(n,"traveller must have destination");var o=c.default.getNextRoad(this,n);(0,t.default)(this.outgoingConnections.includes(o),"nextRoad must be from this intersection"),e.removeFromCurrentRoad(),o.addTravellerAtStart(e)}},{key:"getAllReachableNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return e.add(this),(0,r.uniq)((0,r.flatten)(this._connectionSet.outgoing.map(function(n){return n.getAllReachableNodes(e)})))}},{key:"getVisualConnectionPointAtAngle",value:function(){return this.position}},{key:"getClosestOutgoingTraveller",value:function(){var e=null,n=1/0;return this.outgoingConnections.forEach(function(t){var o=t.getTravellerAfterPosition(-1);o&&o.positionOnCurrentRoad<n&&(e=o,n=o.positionOnCurrentRoad)}),e}},{key:"getClosestIncomingTraveller",value:function(){var e=null,n=1/0;return this.incomingConnections.forEach(function(t){var o=t.getTravellerBeforePosition(t.length);o&&o.distanceToEndOfCurrentRoad<n&&(e=o,n=o.distanceToEndOfCurrentRoad)}),e}},{key:"connectTo",value:function(e,n){this._connectionSet.add(e,n)}},{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}},{key:"canConsumeTraveller",get:function(){return!0}}]),n}();exports.default=d;
},{"invariant":21,"../../lib/geom/Vector2":35,"../../lib/util":29,"../lib/ConnectionSet":59,"../lib/PathFinder":63}],60:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),e=require("../../lib/geom/Vector2"),i=r(e),n=require("../../lib/util");function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=.3,u=Math.PI/2,h=function(t){var e=t.radius,i=t.hipHeight,n=t.legWidth;return Math.sqrt(e*e-(e-i)*(e-i))-n},a=function(){function e(t,i,n){s(this,e),this._stepProgress=0,this._restTimer=0,this._currentStepMaxLift=1,this._owner=t,this._config=i,this._angleOffset=n,this._hipRadius=h(i),this._kneeRadius=h(i)*i.kneeScale,this._floorRadius=h(i),this._lastFootOnFloorXY=this._getIdealFootRestingXY(),this._lastFootOnFloorPalPosition=this._owner.position}return t(e,[{key:"update",value:function(t){if(this._restTimer=(0,n.constrain)(0,this._config.stepRestDuration,this._restTimer-t),!this.isResting)if(this.isStepping)this._stepProgress=(0,n.constrain)(0,1,this._stepProgress+t/this._config.stepDuration),1===this._stepProgress&&(this._lastFootOnFloorXY=this._getCurrentFootXY(),this._lastFootOnFloorPalPosition=this._owner.position,this._stepProgress=0,this._restTimer=this._config.stepDuration);else{var e=this._getCurrentFootXY().distanceTo(this._getIdealFootRestingXY());e>this._config.stepThreshold&&this._owner.canLiftLeg(this)&&(this._currentStepMaxLift=(0,n.constrain)(0,1,(0,n.mapRange)(this._config.stepThreshold,this._config.fullStepDistance,.1,1,e)),this._stepProgress=(0,n.constrain)(0,1,this._stepProgress+t/this._config.stepDuration))}}},{key:"draw",value:function(t){t.beginPath();var e=(0,n.constrain)(0,1,Math.abs((0,n.normaliseAngle)(-u-this.angle)/u)),i=this._config.color.darken(.2*(1-e*e)),r=this._projectZ(this._getCurrentHipXY(),this._getCurrentHipZ(),this._getCurrentHipOrigin()),s=this._projectZ(this._getCurrentKneeXY(),this._getCurrentKneeZ(),this._getCurrentKneeOrigin()),o=this._projectZ(this._getCurrentFootXY(),this._getCurrentFootZ(),this._getCurrentFootOrigin());t.moveTo(r.x,r.y),t.quadraticCurveTo(s.x,s.y,o.x,o.y),t.lineCap="round",t.strokeStyle=i.toString(),t.lineWidth=this._config.legWidth,t.stroke()}},{key:"_projectZ",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._owner.position;return new i.default(t.x,n.y-e+(t.y-n.y)*o)}},{key:"_getIdealFootRestingXY",value:function(){return this._owner.position.add(i.default.fromMagnitudeAndAngle(this._floorRadius,this._owner.heading+this._angleOffset))}},{key:"_getPredictedIdealFootXYAtEndOfOfStep",value:function(){var t=(1.4-this._stepProgress)*this._config.stepDuration,e=this._owner.velocity.scale(t).add(this._owner.position),n=this._owner.heading+this._owner.headingVelocity*t;return e.add(i.default.fromMagnitudeAndAngle(this._floorRadius,n+this._angleOffset))}},{key:"_getCurrentFootXY",value:function(){if(this.isStepping){var t=this._lastFootOnFloorXY,e=this._getPredictedIdealFootXYAtEndOfOfStep();return t.lerp(e,this._stepProgress)}return this._lastFootOnFloorXY}},{key:"_getCurrentFootZ",value:function(){return(0,n.lerp)(0,this._getCurrentHipZ()*this._config.legMaxLift,this.liftAmount)}},{key:"_getCurrentFootOrigin",value:function(){return this.isStepping?this._lastFootOnFloorPalPosition.lerp(this._owner.position,this._stepProgress):this._lastFootOnFloorPalPosition}},{key:"_getCurrentKneeXY",value:function(){return this._owner.position.add(i.default.fromMagnitudeAndAngle(this._kneeRadius,this._owner.heading+this._angleOffset)).add(i.default.fromMagnitudeAndAngle(this.liftAmount*this._config.kneeMaxOut,this._owner.heading))}},{key:"_getCurrentKneeZ",value:function(){return(this._getCurrentFootZ()+this._getCurrentHipZ())/2}},{key:"_getCurrentKneeOrigin",value:function(){return this._getCurrentHipOrigin().lerp(this._getCurrentFootOrigin(),.5)}},{key:"_getCurrentHipXY",value:function(){return this._owner.position.add(i.default.fromMagnitudeAndAngle(this._hipRadius,this._owner.heading+this._angleOffset))}},{key:"_getCurrentHipZ",value:function(){return this._owner.position.y-this._owner.hipCenter.y-(this._config.radius-this._config.hipHeight)}},{key:"_getCurrentHipOrigin",value:function(){return this._owner.position}},{key:"angle",get:function(){return this._owner.heading+this._angleOffset}},{key:"isStepping",get:function(){return this._stepProgress>0}},{key:"isResting",get:function(){return this._restTimer>0}},{key:"liftAmount",get:function(){return Math.sin(this._stepProgress*Math.PI)*this._currentStepMaxLift}},{key:"stepProgress",get:function(){return this._stepProgress}}]),e}();exports.default=a;
},{"../../lib/geom/Vector2":35,"../../lib/util":29}],16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),t=require("invariant"),i=_(t),n=require("../../lib/core/SceneObject"),r=_(n),o=require("../../lib/geom/Vector2"),s=_(o),a=require("../../lib/geom/Circle"),h=_(a),l=require("../../lib/ShapeHelpers"),u=_(l),c=require("../../lib/util"),g=require("../../colors"),d=require("./PalLeg"),f=_(d);function _(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=80,m=200,k=200,R=Math.PI/2,w=function(){var e=(0,c.varyRelative)(14,.2),t=(0,c.varyRelative)(.7*e,.3),i=(0,c.varyRelative)(2*e,.3),n=i-(e-t);return{radius:e,bodHeight:i,bodBob:(0,c.varyRelative)(e,.2),eyeY:(0,c.varyRelative)(.5*e,.2),eyeX:(0,c.varyRelative)(.4*e,.3),eyeRadius:(0,c.varyRelative)(.15*e,.4),mouthThickness:(0,c.varyRelative)(.15*e,.4),mouthY:(0,c.varyAbsolute)(0,.2*e),mouthWidth:(0,c.varyRelative)(.5*e,.3),mouthSmile:(0,c.varyRelative)(.3*e,.3),buttTop:(0,c.varyRelative)(.4*e,.2),buttBottom:(0,c.varyRelative)(.85*e,.15),buttThickness:(0,c.varyRelative)(.1*e,.5),color:g.BLUE.lighten((0,c.random)(-.2,.2)).saturate((0,c.random)(-.2,.2)).rotate((0,c.random)(-10,10)),hipHeight:t,kneeScale:(0,c.varyAbsolute)(1.3,.3),legMaxLift:(0,c.random)(.2,.5),kneeMaxOut:(0,c.varyRelative)(.6*n,.4),stepDuration:(0,c.varyRelative)(.01*n,.4),stepRestDuration:(0,c.varyRelative)(.0083*n,.4),stepThreshold:(0,c.varyRelative)(.01*n,.4),fullStepDistance:(0,c.varyRelative)(.7*n,.4),legWidth:(0,c.varyRelative)(.3*e,.4),legPairs:(0,c.randomInt)(1,4)}},x=function(t){function n(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w();y(this,n);var r=v(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));r._heading=0,r._speed=0,r._headingVelocity=0,r.position=new s.default(e,t),r._config=i,r._target=new s.default(e,t),r._heading=Math.PI/2;var o={radius:i.radius,color:i.color,fullStepDistance:i.fullStepDistance,hipHeight:i.hipHeight,kneeMaxOut:i.kneeMaxOut,kneeScale:i.kneeScale,legMaxLift:i.legMaxLift,legWidth:i.legWidth,stepDuration:i.stepDuration,stepRestDuration:i.stepRestDuration,stepThreshold:i.stepThreshold};return r._legs=(0,c.shuffle)((0,c.flatten)((0,c.times)(i.legPairs,function(e){var t=(e+1)/(i.legPairs+1);return[new f.default(r,o,(0,c.lerp)(R-1,R+1,t)),new f.default(r,o,(0,c.lerp)(1-R,-R-1,t))]}))),r}return p(n,r.default),e(n,[{key:"setTarget",value:function(e,t){this._target=new s.default(e,t)}},{key:"canLiftLeg",value:function(e){var t=this;(0,i.default)(this._legs.includes(e),"whos leg even is this");var n=this._legs.filter(function(t){return t!==e&&!t.isStepping}).length>Math.floor(Math.log(this._legs.length)),r=this._legs.some(function(e){return e.stepProgress>0&&e.stepProgress<1/(t._legs.length/1.5)});return n&&!r}},{key:"update",value:function(e){var t=e/1e3,i=this.position.angleBetween(this._target),n=(0,c.normaliseAngle)(i-this._heading),r=this._heading;this._heading+=n/10,this._headingVelocity=(0,c.normaliseAngle)(this._heading-r)/t,this._target.distanceTo(this.position)>15?this._accelerate(m,t):this._accelerate(-k,t),this._legs.forEach(function(e){return e.update(t)})}},{key:"updateWithPosition",value:function(e,t,i){var n=this.position,r=this._heading;this._heading=t,this._headingVelocity=(0,c.normaliseAngle)(this._heading-r)/i,this._speed=n.distanceTo(e)/i,this.position=e,this._legs.forEach(function(e){return e.update(i)})}},{key:"_accelerate",value:function(e,t){var i=this._speed;this._speed=(0,c.constrain)(0,b,this._speed+e*t);var n=(i+this._speed)/2;this.position=this.position.add(s.default.fromMagnitudeAndAngle(n*t,this._heading))}},{key:"draw",value:function(e){var t=(0,c.normaliseAngle)(this._heading);e.setLineDash([]),e.beginPath(),e.ellipse(this.position.x,this.position.y,.8*this.bod.radius,.8*this.bod.radius*.3,0,0,2*Math.PI),e.fillStyle="rgba(0, 0, 0, 0.2)",e.fill(),this._legs.filter(function(e){return(0,c.normaliseAngle)(e._angleOffset+t)<0}).forEach(function(t){return t.draw(e)}),this._legs.filter(function(e){return(0,c.normaliseAngle)(e._angleOffset+t)>=0}).forEach(function(t){return t.draw(e)}),this._drawBod(e)}},{key:"_drawBod",value:function(e){e.save(),e.beginPath(),u.default.circle(e,this.bod.center.x,this.bod.center.y,this._config.radius),e.fillStyle=this._config.color.toString(),e.fill(),e.clip();var t=(0,c.normaliseAngle)(R-this._heading)/R*this._config.radius;e.beginPath(),u.default.circle(e,t+this.bod.center.x+this._config.eyeX,this.bod.center.y-this._config.eyeY,this._config.eyeRadius),u.default.circle(e,t+this.bod.center.x-this._config.eyeX,this.bod.center.y-this._config.eyeY,this._config.eyeRadius),e.fillStyle=this._config.color.darken(.5).toString(),e.fill(),e.beginPath(),e.moveTo(t+this.bod.center.x-this._config.mouthWidth,this.bod.center.y-this._config.mouthY),e.quadraticCurveTo(t+this.bod.center.x,this.bod.center.y-this._config.mouthY+this._config.mouthSmile,t+this.bod.center.x+this._config.mouthWidth,this.bod.center.y-this._config.mouthY),e.lineWidth=this._config.mouthThickness,e.strokeStyle=this._config.color.darken(.5).toString(),e.stroke(),e.beginPath(),this._makeButtLine(e,t+2*this._config.radius),this._makeButtLine(e,t-2*this._config.radius),e.lineWidth=this._config.buttThickness,e.strokeStyle=this._config.color.darken(.3).toString(),e.stroke(),e.restore()}},{key:"_makeButtLine",value:function(e,t){e.moveTo(1.6*t+this.bod.center.x,this.bod.center.y+this._config.buttTop),e.quadraticCurveTo(1.7*t+this.bod.center.x,this.bod.center.y+.65*(this._config.buttTop+this._config.buttBottom),t+this.bod.center.x,this.bod.center.y+this._config.buttBottom)}},{key:"hipCenter",get:function(){var e=this._legs?this._legs.reduce(function(e,t){return e+t.liftAmount},0)/this._legs.length:0,t=this._config.bodBob*e;return new s.default(this.position.x,this.position.y-this._config.bodHeight-t)}},{key:"bod",get:function(){var e=this.hipCenter;return new h.default(e.x,e.y,this._config.radius)}},{key:"heading",get:function(){return this._heading}},{key:"_headingVec",get:function(){return s.default.fromMagnitudeAndAngle(1,this._heading)}},{key:"velocity",get:function(){return this._headingVec.scale(this._speed)}},{key:"headingVelocity",get:function(){return this._headingVelocity}}]),n}();exports.default=x;
},{"invariant":21,"../../lib/core/SceneObject":34,"../../lib/geom/Vector2":35,"../../lib/geom/Circle":36,"../../lib/ShapeHelpers":30,"../../lib/util":29,"../../colors":27,"./PalLeg":60}],28:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),t=require("invariant"),i=g(t),n=require("../lib/core/SceneObject"),r=g(n),o=require("../lib/geom/Circle"),s=g(o),a=require("../lib/geom/Vector2"),u=g(a),d=require("../lib/easings"),c=require("../lib/util"),l=require("../systems/TravellerFinder"),h=g(l),_=require("./networkNodes/Intersection"),p=g(_),f=require("./pal/Pal"),R=g(f);function g(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var T=60,O=60,m=30,F=30,S=200,k=5,A=80,b=200,C=-200,E=0,D=1500,x=100,w=400,I=400,N=(0,d.outBack)(3),q=(0,d.inBack)(3),j={STOPPED_FOR_DESTINATION:"STOPPED_FOR_DESTINATION",STOPPED_FOR_TRAFFIC_IN_FRONT:"STOPPED_FOR_TRAFFIC_IN_FRONT",STOPPED_FOR_TRAFFIC_NEARBY:"STOPPED_FOR_TRAFFIC_NEARBY"},M=function(t){function n(){var e,t,i;v(this,n);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return t=i=y(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(o))),i.comfortableRadius=(0,c.random)(T,O),i.safeRadius=(0,c.random)(m,F),i._currentRoad=null,i._destination=null,i._positionOnCurrentRoad=0,i._speed=k,i._age=0,i._exitStartedAt=null,i._stoppedTime=0,i._forceAccelerateTimer=0,i._stopReason=null,i._stoppedFor=[],i._pal=null,y(i,t)}return P(n,r.default),e(n,[{key:"isStoppedFor",value:function(e){return this._stoppedFor.includes(e)}},{key:"onAddedToRoad",value:function(e){this._currentRoad=e,this._positionOnCurrentRoad=0,this._destination||this._pickDestination()}},{key:"onRemovedFromRoad",value:function(){this.getScene().getSystem(h.default).removeTraveller(this),this._currentRoad=null}},{key:"onRemovedFromScene",value:function(){this.removeFromCurrentRoad()}},{key:"removeFromCurrentRoad",value:function(){this._currentRoad&&this._currentRoad.removeTraveller(this)}},{key:"update",value:function(e){this._age+=e,this._stopReason=null,this._stoppedFor=[];var t=this._currentRoad;(0,i.default)(t,"current road must be defined"),this._move(e,t),this._getPal().updateWithPosition(this.position,t.getAngleAtPosition(this._positionOnCurrentRoad),e/1e3),window.debugDraw&&this._debugDraw(),this._checkAtEndOfRoad(t),this._checkExit()}},{key:"draw",value:function(e){var t=this._currentRoad;(0,i.default)(t,"current road must be defined"),this._getPal().draw(e)}},{key:"getCurrentZ",value:function(){return this.position.y}},{key:"_getPal",value:function(){return this._pal||(this._pal=new R.default(this.position.x,this.position.y)),this._pal}},{key:"_debugDraw",value:function(){if(this._currentRoad){var e=this.predictedStopPoint;new s.default(this.position.x,this.position.y,this.comfortableRadius).debugDraw("rgba(0, 255, 0, 0.4)"),new s.default(this.position.x,this.position.y,this.safeRadius).debugDraw(this._forceAccelerateTimer?"cyan":"red"),e.debugDraw("lime"),this.predictedStopArea.debugDraw("rgba(255, 0, 255, 0.5)"),window.debugContext.fillText(this.id+" "+Math.round(this._stoppedTime),this.position.x,this.position.y)}}},{key:"_getEnterTransitionScale",value:function(){return N((0,c.constrain)(0,1,(0,c.mapRange)(0,w,0,1,this._age)))}},{key:"_getExitTransitionScale",value:function(){return null===this._exitStartedAt?1:1-q((0,c.constrain)(0,1,(0,c.mapRange)(this._exitStartedAt,this._exitStartedAt+I,0,1,this._age)))}},{key:"_getPredictedStopPositionIfDecelerating",value:function(){var e=-this._speed/C;return this._positionOnCurrentRoad+this._speed*e+.5*C*e*e}},{key:"_getPredictedPointForPosition",value:function(e,t){if(t<=e.length)return e.getPointAtPosition(t);var i=t-e.length,n=e.getAngleAtPosition(e.length);return u.default.fromMagnitudeAndAngle(i,n).add(e.end)}},{key:"_pickDestination",value:function(){if(this._currentRoad){var e=this._currentRoad.getAllReachableNodes().filter(function(e){return e.isDestination}),t=(0,c.sample)(e);this._destination=t}}},{key:"_move",value:function(e,t){var i=e/1e3;this._forceAccelerateTimer=(0,c.constrain)(0,x,this._forceAccelerateTimer-e),this._forceAccelerateTimer<=0&&this._shouldDecelerate(t)?this._accelerate(C,i,t):this._accelerate(b,i,t),0===this._speed?this._stoppedTime+=e:this._stoppedTime=0}},{key:"_shouldDecelerate",value:function(e){var t=this._getPredictedStopPositionIfDecelerating();if(e.to===this._destination&&e.length+E<t)return this._stopReason=j.STOPPED_FOR_DESTINATION,!0;var i=e.getTravellerAfterPosition(this._positionOnCurrentRoad),n=t+this.comfortableRadius;if(i&&i.positionOnCurrentRoad<n)return this._stopReason=j.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(i),!0;if(e.to instanceof p.default){var r=e.to,o=r.getClosestOutgoingTraveller();if(o)if(e.length+o.positionOnCurrentRoad<n)return this._stopReason=j.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(o),!0;var s=r.getClosestIncomingTraveller();if(s&&s!==this)if(e.length-s.distanceToEndOfCurrentRoad<n)return this._stopReason=j.STOPPED_FOR_TRAFFIC_IN_FRONT,this._stoppedFor.push(s),!0}return!!this._shouldDecelerateForNearbyTravellers(e)&&(this._stopReason=j.STOPPED_FOR_TRAFFIC_NEARBY,!0)}},{key:"_shouldDecelerateForNearbyTravellers",value:function(e){var t=this.getScene().getSystem(h.default),i=this.predictedStopArea,n=i.center,r=this.potentialNextPredictedStopPoint,o=i.withRadius(S),s=t.findTravellersInCircle(o),a=!0,u=!1,d=void 0;try{for(var c,l=s[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var _=c.value;if(_!==this){var p=_.predictedStopArea,f=p.center;if(i.intersectsCircle(p)){var R=_.potentialNextPredictedStopPoint,g=n.distanceTo(p.center);if(!(r.distanceTo(R)>g)){var v=n.distanceTo(R),y=f.distanceTo(r);if(!(v<y||v-y<.15)){if(v===y)return Math.random()<.5;if(this._stoppedTime>D&&!_.isStopped)return this._forceAcceleration(),!1;_.isStoppedFor(this)||this._stoppedFor.push(_)}}}}}}catch(e){u=!0,d=e}finally{try{!a&&l.return&&l.return()}finally{if(u)throw d}}return!!this._stoppedFor.length}},{key:"_forceAcceleration",value:function(){this._forceAccelerateTimer=x}},{key:"_accelerate",value:function(e,t,i){var n=this._speed;this._speed=(0,c.constrain)(0,A,this._speed+e*t);var r=(n+this._speed)/2;this._positionOnCurrentRoad=(0,c.constrain)(0,i.length,this._positionOnCurrentRoad+r*t)}},{key:"_checkAtEndOfRoad",value:function(e){if(this._positionOnCurrentRoad===e.length){if(this._isExiting)return;this._onReachEndOfCurrentRoad(e)}}},{key:"_checkExit",value:function(){this._isExiting&&this._age>=this._exitStartedAt+I&&this._onExit()}},{key:"_onReachEndOfCurrentRoad",value:function(e){var t=e.to,i=this._destination;t.canConsumeTraveller&&(t.consumeTraveller(this),t===i&&this._onReachDestination())}},{key:"_onReachDestination",value:function(){this._exit()}},{key:"_onExit",value:function(){this.getScene().removeChild(this)}},{key:"_exit",value:function(){this._exitStartedAt=this._age}},{key:"currentRoad",get:function(){return this._currentRoad}},{key:"position",get:function(){return(0,i.default)(this._currentRoad,"currentRoad must be defined"),this._currentRoad.getPointAtPosition(this._positionOnCurrentRoad)}},{key:"predictedStopPoint",get:function(){var e=this._currentRoad;(0,i.default)(e,"currentRoad must be defined");var t=this._getPredictedStopPositionIfDecelerating();return this._getPredictedPointForPosition(e,t)}},{key:"predictedStopArea",get:function(){var e=this.predictedStopPoint;return new s.default(e.x,e.y,this.safeRadius)}},{key:"potentialNextPredictedStopPoint",get:function(){var e=this._currentRoad;(0,i.default)(e,"currentRoad must be defined");var t=this._getPredictedStopPositionIfDecelerating();return this._getPredictedPointForPosition(e,t+1)}},{key:"positionOnCurrentRoad",get:function(){return this._positionOnCurrentRoad}},{key:"distanceToEndOfCurrentRoad",get:function(){return(0,i.default)(this._currentRoad,"traveller is not on a road"),this._currentRoad.length-this._positionOnCurrentRoad}},{key:"destination",get:function(){return this._destination}},{key:"speed",get:function(){return this._speed}},{key:"isStopped",get:function(){return 0===this.speed}},{key:"stoppedTime",get:function(){return this._stoppedTime}},{key:"stopReason",get:function(){return this._stopReason}},{key:"_isExiting",get:function(){return null!==this._exitStartedAt}}]),n}();M.MAX_SPEED=A,M.StopReasons=j,exports.default=M;
},{"invariant":21,"../lib/core/SceneObject":34,"../lib/geom/Circle":36,"../lib/geom/Vector2":35,"../lib/easings":57,"../lib/util":29,"../systems/TravellerFinder":12,"./networkNodes/Intersection":37,"./pal/Pal":16}],43:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),e=require("invariant"),n=g(e),r=require("../../util"),i=require("../Circle"),a=g(i),s=require("../Vector2"),u=g(s),o=require("./StraightPathSegment"),l=g(o),f=require("./CirclePathSegment"),h=g(f);function g(t){return t&&t.__esModule?t:{default:t}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function(){function e(){c(this,e),this.segments=[],this.addSegments.apply(this,arguments)}return t(e,null,[{key:"straightThroughPoints",value:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=u.default.from(n.shift()),a=new e;return n.map(u.default.from).forEach(function(t){a.addSegment(new l.default(i,t)),i=t}),a}}]),t(e,[{key:"getPointAtPosition",value:function(t){var e=(0,r.constrain)(0,this.length,t),n=0,i=!0,a=!1,s=void 0;try{for(var u,o=this.segments[Symbol.iterator]();!(i=(u=o.next()).done);i=!0){var l=u.value;if(e<=n+l.length)return l.getPointAtPosition(e-n);n+=l.length}}catch(t){a=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw s}}throw new Error("this is supposed to be unreachable oops")}},{key:"getAngleAtPosition",value:function(t){var e=(0,r.constrain)(0,this.length,t),n=0,i=!0,a=!1,s=void 0;try{for(var u,o=this.segments[Symbol.iterator]();!(i=(u=o.next()).done);i=!0){var l=u.value;if(e<=n+l.length)return l.getAngleAtPosition(e-n);n+=l.length}}catch(t){a=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw s}}throw new Error("this is supposed to be unreachable oops")}},{key:"addSegment",value:function(t){var e=this.segments[this.segments.length-1];return e&&(0,n.default)(e.end.equals(t.start),"segments must neatly join together - "+e.end.toString()+" !== "+t.start.toString()),this.segments.push(t),this}},{key:"addSegments",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach(function(e){return t.addSegment(e)}),this}},{key:"autoRound",value:function(t){var e=this,i=this.segments.map(function(r,i){var s=0===i?null:e.segments[i-1];if(!s)return r instanceof l.default?null:r;if(!(r instanceof l.default))return r;if(!(s instanceof l.default))return null;(0,n.default)(s.end.equals(r.start),"segments must join");var u=s.angle,o=r.angle,f=Math.min(t,s.length/2,r.length/2),g=new a.default(r.start.x,r.start.y,f);return h.default.withinCircle(g,u,o)}),s=(0,r.compact)(i),u=this.start,o=this.end,f=u;return this.segments=[],s.forEach(function(t){t.start.equals(f)?e.addSegment(t):(e.addSegment(new l.default(f,t.start)),e.addSegment(t)),f=t.end}),f.equals(o)||this.addSegment(new l.default(f,o)),this}},{key:"freeze",value:function(){return Object.freeze(this),this}},{key:"start",get:function(){return this.segments[0].start}},{key:"end",get:function(){return this.segments[this.segments.length-1].end}},{key:"length",get:function(){return this.segments.reduce(function(t,e){return t+e.length},0)}}]),e}();exports.default=d;
},{"invariant":21,"../../util":29,"../Circle":36,"../Vector2":35,"./StraightPathSegment":44,"./CirclePathSegment":42}],10:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var c=r.get;return void 0!==c?c.call(i):void 0},n=require("../lib/util"),i=require("../lib/core/SceneObject"),r=v(i),o=require("../lib/geom/Vector2"),c=v(o),s=require("../lib/geom/Circle"),u=v(s),a=require("../lib/geom/path/CirclePathSegment"),l=v(a),f=require("../lib/geom/path/Path"),d=v(f),_=require("./Road"),h=v(_),p=require("./networkNodes/Intersection"),g=v(p),y=require("./lib/ConnectionDirections"),b=v(y);function v(e){return e&&e.__esModule?e:{default:e}}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(i){function o(e,t,n){A(this,o);var i=w(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return i._intersectionsByAngle={},i._incomingIntersections=new Set,i._outgoingIntersections=new Set,i._roads=[],i._circle=new u.default(e,t,n),i}return O(o,r.default),e(o,[{key:"onAddedToScene",value:function(e){t(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"onAddedToScene",this).call(this,e),this._roads.forEach(function(t){return e.addChild(t)})}},{key:"getVisualConnectionPointAtAngle",value:function(e){return this._circle.pointOnCircumference(e)}},{key:"connectToRoadAtAngle",value:function(e,t,n){var i=this,r=this._intersectionAtAngle(t);r.connectTo(e,n);var o=n===b.default.IN||this._incomingIntersections.has(r),c=n===b.default.OUT||this._outgoingIntersections.has(r);return o&&this._incomingIntersections.add(r),c&&this._outgoingIntersections.add(r),this._intersections.forEach(function(e){if(e!==r){if(o&&i._outgoingIntersections.has(e)){var t=new d.default(l.default.withinCircle(i._circle,i._circle.center.subtract(r.position).angle,e.position.subtract(i._circle.center).angle));i._addRoad(new h.default(r,e,{path:t}))}if(c&&i._incomingIntersections.has(e)){var n=new d.default(l.default.withinCircle(i._circle,i._circle.center.subtract(e.position).angle,r.position.subtract(i._circle.center).angle));i._addRoad(new h.default(e,r,{path:n}))}}}),r}},{key:"_intersectionAtAngle",value:function(e){var t=e.toString();if(this._intersectionsByAngle[t])return this._intersectionsByAngle[t];var n=this._createIntersectionAtAngle(e);return this._intersectionsByAngle[t]=n,n}},{key:"_createIntersectionAtAngle",value:function(e){var t=this.getVisualConnectionPointAtAngle(e);return new g.default(t.x,t.y)}},{key:"_addRoad",value:function(e){this._roads.push(e),this._scene&&this._scene.addChild(e)}},{key:"position",get:function(){return this._circle.center}},{key:"_intersections",get:function(){var e=this;return(0,n.compact)(Object.keys(this._intersectionsByAngle).map(function(t){return e._intersectionsByAngle[t]}))}}]),o}();exports.default=m;
},{"../lib/util":29,"../lib/core/SceneObject":34,"../lib/geom/Vector2":35,"../lib/geom/Circle":36,"../lib/geom/path/CirclePathSegment":42,"../lib/geom/path/Path":43,"./Road":9,"./networkNodes/Intersection":37,"./lib/ConnectionDirections":38}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("../lib/core/SceneObject"),n=A(t),r=require("../lib/geom/path/Path"),o=A(r),i=require("../lib/geom/path/StraightPathSegment"),a=A(i),l=require("../lib/geom/Vector2"),u=A(l),s=require("../lib/ShapeHelpers"),c=A(s),f=require("../colors"),h=require("./lib/ConnectionDirections"),d=A(h),g=require("./Junction"),v=A(g),p=require("./Traveller"),y=A(p);function A(e){return e&&e.__esModule?e:{default:e}}function _(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var P=f.YELLOW.darken(.2),k=3,O=[5,10],w=O.reduce(function(e,t){return e+t},0),S=.05,R=function(t){function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.points,l=n.autoRound,s=n.path;T(this,r);var c=b(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));c.isNode=!1,c._currentTravellers=[];var f=i?e.position.angleBetween(u.default.from(i[0])):e.position.angleBetween(t.position),h=i?t.position.angleBetween(u.default.from(i[i.length-1])):t.position.angleBetween(e.position);return c._path=s||(i?o.default.straightThroughPoints.apply(o.default,[e.getVisualConnectionPointAtAngle(f)].concat(_(i),[t.getVisualConnectionPointAtAngle(h)])):(new o.default).addSegment(new a.default(e.getVisualConnectionPointAtAngle(f),t.getVisualConnectionPointAtAngle(h)))),null!=l&&c._path.autoRound(l),e instanceof v.default?c.from=e.connectToRoadAtAngle(c,f,d.default.OUT):(c.from=e,e.connectTo(c,d.default.OUT)),t instanceof v.default?c.to=t.connectToRoadAtAngle(c,h,d.default.IN):(c.to=t,t.connectTo(c,d.default.IN)),c}return m(r,n.default),e(r,[{key:"canAddTravellerAtStart",value:function(){var e=this.getTravellerAfterPosition(0);return!e||e.positionOnCurrentRoad>e.comfortableRadius}},{key:"addTravellerAtStart",value:function(e){this._currentTravellers.push(e),e.onAddedToRoad(this)}},{key:"removeTraveller",value:function(e){var t=this._currentTravellers.indexOf(e);return-1!==t&&(this.removeTravellerAtIndex(t),!0)}},{key:"removeTravellerAtIndex",value:function(e){var t=this._currentTravellers[e];return this._currentTravellers.splice(e,1),t.onRemovedFromRoad(),t}},{key:"getAllReachableNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return e.has(this.to)?[]:[].concat(_(this.to.getAllReachableNodes(e)),[this.to])}},{key:"getPointAtPosition",value:function(e){return this._path.getPointAtPosition(e)}},{key:"getAngleAtPosition",value:function(e){return this._path.getAngleAtPosition(e)}},{key:"getTravellerAfterPosition",value:function(e){var t=null,n=1/0;return this._currentTravellers.forEach(function(r){var o=r.positionOnCurrentRoad-e;o<=0||o<n&&(n=o,t=r)}),t}},{key:"getTravellerBeforePosition",value:function(e){var t=null,n=1/0;return this._currentTravellers.forEach(function(r){var o=e-r.positionOnCurrentRoad;o<=0||o<n&&(n=o,t=r)}),t}},{key:"draw",value:function(e,t){e.beginPath(),e.lineCap="round",e.lineJoin="round",c.default.path(e,this._path);var n=this._getLineDashScale(),r=w*n;e.setLineDash(O.map(function(e){return e*n})),e.strokeStyle=P.toString(),e.lineDashOffset=-t*S*n%r,e.lineWidth=k,e.stroke()}},{key:"_getLineDashScale",value:function(){var e=Math.floor(this.length/w)*w;return this.length-e<e+w-this.length?this.length/e:this.length/(e+w)}},{key:"length",get:function(){return this._path.length}},{key:"start",get:function(){return this._path.start}},{key:"end",get:function(){return this._path.end}},{key:"expectedTimeFromStartToEnd",get:function(){if(this._currentTravellers.length){var e=this._currentTravellers.reduce(function(e,t){return e+t.speed},0)/this._currentTravellers.length;return this.length/e}return this.length/(.7*y.default.MAX_SPEED)}}]),r}();exports.default=R;
},{"../lib/core/SceneObject":34,"../lib/geom/path/Path":43,"../lib/geom/path/StraightPathSegment":44,"../lib/geom/Vector2":35,"../lib/ShapeHelpers":30,"../colors":27,"./lib/ConnectionDirections":38,"./Junction":10,"./Traveller":28}],15:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t=require("../../lib/core/SceneObject"),n=g(t),i=require("../../lib/geom/Circle"),r=g(i),o=require("../../lib/ShapeHelpers"),c=g(o),l=require("../../lib/easings"),u=require("../../lib/util"),a=require("../../effects/Pulse"),s=g(a),f=require("../../colors"),h=require("../lib/ConnectionSet"),d=g(h),_=require("../Traveller"),p=g(_),v=require("../Road"),y=g(v);function g(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var w=500,T=20,k=30,C=.7*T,O=35,P=500,q=150,E=f.TEAL.lighten(.1),x=f.TEAL.darken(.1),A=f.TEAL.lighten(.2).fade(.1),j=function(t){function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;m(this,i);var o=b(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.isDestination=!1,o.canConsumeTraveller=!1,o._connectionSet=new d.default,o._circle=new r.default(e,t,T),o._visualConnectionCircle=new r.default(e,t,k),o._cooldown=n,o._timer=n,o}return S(i,n.default),e(i,[{key:"getAllReachableNodes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return e.add(this),(0,u.uniq)((0,u.flatten)(this._connectionSet.outgoing.map(function(t){return t.getAllReachableNodes(e)})))}},{key:"getVisualConnectionPointAtAngle",value:function(e){return this._visualConnectionCircle.pointOnCircumference(e)}},{key:"consumeTraveller",value:function(){throw new Error("producer cannot consume traveller")}},{key:"connectTo",value:function(e,t){this._connectionSet.add(e,t)}},{key:"update",value:function(e){this._timer=(0,u.constrain)(0,this._cooldown,this._timer+e),this._timer>=this._cooldown&&this._onTimerEnd()}},{key:"draw",value:function(e){var t=this._timer/this._cooldown,n=(0,u.constrain)(0,1,(0,u.mapRange)(0,q,1,0,this._timer)),i=E.mix(x,n);e.beginPath(),e.fillStyle=i.toString(),c.default.circle(e,this._circle.center.x,this._circle.center.y,this._circle.radius),e.fill(),e.beginPath(),e.fillStyle=x.toString(),e.moveTo(this._circle.center.x,this._circle.center.y),e.arc(this._circle.center.x,this._circle.center.y,this._circle.radius,-Math.PI/2,2*t*Math.PI-Math.PI/2,!1),e.fill(),e.beginPath(),e.fillStyle=E.toString(),c.default.circle(e,this._circle.center.x,this._circle.center.y,C),e.fill()}},{key:"_resetTimer",value:function(){this._timer=0}},{key:"_onTimerEnd",value:function(){this._attemptEmitTraveller()&&(this._pulse(),this._resetTimer())}},{key:"_pulse",value:function(){this.getScene().addChildBefore(this,new s.default({x:this._circle.center.x,y:this._circle.center.y,startRadius:T,endRadius:O,duration:P,color:A,easeRadius:l.outSine,removeOnComplete:!0}))}},{key:"_attemptEmitTraveller",value:function(){var e=this._connectionSet.sampleOutgoing();if(!(e instanceof y.default))return!1;if(e.canAddTravellerAtStart()){var t=new p.default;return e.addTravellerAtStart(t),this.getScene().addChild(t),!0}return!1}},{key:"position",get:function(){return this._circle.center}},{key:"incomingConnections",get:function(){return this._connectionSet.incoming}},{key:"outgoingConnections",get:function(){return this._connectionSet.outgoing}}]),i}();exports.default=j;
},{"../../lib/core/SceneObject":34,"../../lib/geom/Circle":36,"../../lib/ShapeHelpers":30,"../../lib/easings":57,"../../lib/util":29,"../../effects/Pulse":58,"../../colors":27,"../lib/ConnectionSet":59,"../Traveller":28,"../Road":9}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var c=o.get;return void 0!==c?c.call(n):void 0},r=require("../lib/core/SceneSystem"),n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(r){function o(){a(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return e.canvas=document.createElement("canvas"),e.ctx=e.canvas.getContext("2d"),window.debugCanvas=e.canvas,window.debugContext=e.ctx,e}return i(o,n.default),e(o,[{key:"afterAddToScene",value:function(e){t(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"afterAddToScene",this).call(this,e),this.canvas.width=e.width*e.scaleFactor,this.canvas.height=e.height*e.scaleFactor,this.ctx.scale(e.scaleFactor,e.scaleFactor),window.HAIRLINE=1/e.scaleFactor}},{key:"afterDraw",value:function(e){var t=this.getScene(),r=t.width,n=t.height;e.drawImage(this.canvas,0,0,r,n),this.ctx.clearRect(0,0,r,n)}}]),o}();u.systemName="DebugOverlay",exports.default=u;
},{"../lib/core/SceneSystem":31}],6:[function(require,module,exports) {
"use strict";var d=require("invariant"),e=p(d),a=require("./lib/core/Scene"),t=p(a),l=require("./entities/networkNodes/Consumer"),n=p(l),i=require("./entities/networkNodes/Producer"),u=p(i),f=require("./entities/Road"),o=p(f),w=require("./entities/Junction"),r=p(w),h=require("./entities/pal/Pal"),C=p(h),s=require("./systems/DebugOverlay"),c=p(s),v=require("./systems/TravellerFinder"),m=p(v);function p(d){return d&&d.__esModule?d:{default:d}}var q=50,y=void 0,T=function(){var d=new u.default(100,100,500),e=new n.default(400,200,1500),a=new n.default(250,200,1500);y.addChild(d),y.addChild(e),y.addChild(a);var t=new r.default(250,100,q);y.addChild(t),y.addChild(new o.default(d,t)),y.addChild(new o.default(t,e,{points:[[400,100]],autoRound:q})),y.addChild(new o.default(t,a))},R=function(){var d=new u.default(100,300,500),e=new r.default(300,300,q),a=new n.default(300,100,5e3),t=new n.default(500,300,5e3),l=new n.default(300,500,5e3);y.addChild(new o.default(d,e)),y.addChild(new o.default(e,a)),y.addChild(new o.default(e,t)),y.addChild(new o.default(e,l)),y.addChild(d),y.addChild(e),y.addChild(a),y.addChild(t),y.addChild(l)},b=function(){var d=new n.default(300,550,1500),e=new n.default(100,450,1500),a=new n.default(100,250,1500),t=new u.default(600,150,500),l=new u.default(100,100,500);y.addChild(d),y.addChild(e),y.addChild(a),y.addChild(t),y.addChild(l);var i=new r.default(300,150,q),f=new r.default(500,370,q),w=new r.default(330,400,q);y.addChild(i),y.addChild(f),y.addChild(w),y.addChild(new o.default(l,i)),y.addChild(new o.default(t,f)),y.addChild(new o.default(f,w)),y.addChild(new o.default(f,i,{points:[[400,300],[500,50]],autoRound:q})),y.addChild(new o.default(i,w)),y.addChild(new o.default(w,d)),y.addChild(new o.default(i,e)),y.addChild(new o.default(i,a))},g=function(){var d=new u.default(100,100,1e3),e=new u.default(300,200,1e3),a=new u.default(100,300,1e3),t=new n.default(300,100,1e3),l=new n.default(100,200,1e3),i=new n.default(300,300,1e3);y.addChild(d),y.addChild(e),y.addChild(a),y.addChild(t),y.addChild(l),y.addChild(i);var f=new r.default(200,200,30);y.addChild(f),y.addChild(new o.default(d,f)),y.addChild(new o.default(e,f)),y.addChild(new o.default(a,f)),y.addChild(new o.default(f,t)),y.addChild(new o.default(f,l)),y.addChild(new o.default(f,i))},E=function(){var d=new C.default(100,50);y.addChild(d);var a=document.getElementById("root");(0,e.default)(a,"#root must be present"),a.addEventListener("mousemove",function(e){d.setTarget(e.offsetX,e.offsetY)})},P=function(){var d=new u.default(300,50,1500).addTo(y),e=new n.default(500,50,100).addTo(y);new o.default(d,e,{points:[[350,150],[150,350],[400,500],[650,350],[450,150]],autoRound:400}).addTo(y)},S=function(){if(!window.scene){y=new t.default(800,600,window.devicePixelRatio),window.scene=y;var d=document.getElementById("root");(0,e.default)(d,"#root must be present"),y.appendTo(d),y.addSystem(new c.default),y.addSystem(new m.default),b(),y.start()}};S(),module.hot&&(module.hot.dispose(function(){window.location.reload()}),module.hot.accept(function(){window.location.reload()}));
},{"invariant":21,"./lib/core/Scene":13,"./entities/networkNodes/Consumer":14,"./entities/networkNodes/Producer":15,"./entities/Road":9,"./entities/Junction":10,"./entities/pal/Pal":16,"./systems/DebugOverlay":11,"./systems/TravellerFinder":12}]},{},[6])
//# sourceMappingURL=/web-starter/scripts.94fd8154.map